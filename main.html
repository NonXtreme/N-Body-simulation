<html>
	<head>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script>

			function getRandomColor() {
				var letters = '0123456789ABCDEF';
				var color = '#';
				for (var i = 0; i < 6; i++) {
					color += letters[Math.floor(Math.random() * 16)];
				}
				return color;
			}

			function addObj(mass=10,vel={x:0,y:0},pos={x:0,y:0},static=false,radius=0.1){
				var geometry = new THREE.SphereGeometry(radius, 32, 32 );
				var material = new THREE.MeshPhongMaterial({color: getRandomColor()});
				var mesh = new THREE.Mesh( geometry, material );
				mesh.position.set(pos.x, pos.y, 0);
				scene.add( mesh );
				objList.push({mesh:mesh,mass:mass,vel:vel,static:static});
			}

			var objList = [];
			const G=6.674*0.00000000001
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			{
				const color = 0xFFFFFF;
				const intensity = 1;
				const light = new THREE.DirectionalLight(color, intensity);
				light.position.set(-1, 2, 4);
				scene.add(light);
			}

			// addObj(1000000,{x:0.01,y:0},{x:0,y:1});
			// addObj(1000000,{x:-0.01,y:0},{x:0,y:-1});
			// addObj(1000000,{x:0,y:0.01},{x:2,y:0});
			addObj(1000,{x:0,y:0.05},{x:-2,y:0});
			// addObj(1000000,{x:0.01,y:-0.01},{x:0,y:0});
			// addObj(1000000,{x:0,y:0},{x:-10,y:-10});
			addObj(10000000,{x:0,y:0},{x:0,y:0},false);
			addObj(1000,{x:0,y:-0.05},{x:1,y:0});
			// for(var i=0;i<555;i++){
			// 	addObj(10,{x:0,y:0},{x:(Math.random()-0.5)*6,y:(Math.random()-0.5)*6});
			// }

			camera.position.z = 15;

			
			var animate = function () {
				requestAnimationFrame( animate );

				
				renderer.render( scene, camera );
			};

			animate();
			window.setInterval(physics,5);	
			let dt=0;
			var now=window.performance.now();
			var prev=null;

			function physics(){
				now=window.performance.now();
				if(prev==null){
					dt=0;
					console.log("Beginning")
				}else{
					//dt=now-prev;
					 dt=5;
				}
				for(var i=0;i<objList.length;i++){
					let a_sum={x:0,y:0};
					let obj_i=objList[i]
					let i_pos=obj_i.mesh.position
					
					if(!obj_i.static){
						for(var j=0;j<objList.length;j++){
							let obj_j=objList[j]
							let j_pos=obj_j.mesh.position
							
							
							let r2=Math.pow(j_pos.x-i_pos.x, 2)+Math.pow(j_pos.y-i_pos.y, 2); //r^2
							if(r2>0){
								let F=G*obj_i.mass*obj_j.mass/r2 // Gm1m2/r^2

								let r=Math.sqrt(r2);
								let vec_norm={x:(j_pos.x-i_pos.x)/r,y:(j_pos.y-i_pos.y)/r} //Normalized force direction vector

								let a=F/obj_i.mass; //accel

								a_sum.x+=vec_norm.x*a*dt;
								a_sum.y+=vec_norm.y*a*dt;
							}
						}
						obj_i.vel.x+=a_sum.x;
						obj_i.vel.y+=a_sum.y;
					}
				}
				for(var i=0;i<objList.length;i++){
					if(!objList[i].static){
						objList[i].mesh.position.x+=objList[i].vel.x
						objList[i].mesh.position.y+=objList[i].vel.y
					}
				}

				prev=now;
			}
		</script>
	</body>
</html>
